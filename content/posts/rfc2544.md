---
title: "网络互联设备的基准测试方法 RFC2544（译）"
date: 2021-12-02T00:11:23+08:00
draft: true
tags:
    - networking
    - testing
keywords:
    - network
---

## 摘要

本文讨论和定义了一系列测试来描述网络设备的性能特点。除了描述测试本身，本文还定义了如何去报告这些测试的结果。附录A列出了一些测试和情况，我们认为这些测试需要被包含进特定的用例并且针对测试给出额外的信息的。附录B列出了在不同的介质上，不同帧大小的最大参考帧率。附录C给出了一些可以在厕所中使用的帧格式。

## 1. 介绍

厂商们经常会宣称使用了一些“超级技术”来帮助他们进行市场营销，以获得更好的市场地位。这些行为经常会误导那些潜在的产品用户们。

这篇文档定义了一个测试集，以便让厂商可以测试并且报告他们网络设备的性能。这些测试的结果可以让用户们更好的去比对不同厂商的设备性能。

在之前的一篇文档 “网络互联设备的基准测试术语（RFC 1242）” 中，我们定义了许多本文中使用的术语。那篇有关术语的文章应该作为本文的参考一同使用。

## 2. 真实世界情况

在本文的写作过程中，笔者一直牢记这些所有的测试都能够被实际的设备所运行。虽然我们不知道是否有现成的设备能够实现这些所有的测试，但我们认为这样的设备是可以被生产出来的。

## 3. 运行的测试

本文定义了一系列的测试，虽然并不是所有的测试可以应用于所有种类的待测设备，但厂商应该执行特定种类设备可以执行的所有测试。笔者也理解运行所有这些测试需要花费大量的时间，但我相信结果是值得的。附录A列举了一些测试和场景。

## 4. 评估测试结果

运行所有这些推荐的测试将会产生大量的测试数据。大部分测试数据都不适用于评估设备在每种情况下的表现。比如，评估路由器转发 IPX 帧的速度在一个不支持（也不会支持）IPX协议的环境中将没有任何意义。甚至说，评估这样与某种特定网络配置有关的数据将会需要一些经验和背景知识。而且这些经验可能并不容易获得。此外，选择要运行的测试和评估数据也必须要了解普遍能接受的测试实践，包括可重复性，差异性，以及少量实验的统计意义。

## 5. 要求

本文中一些用来定义测试重要性的词语将被加粗，这些词语是：
* **必须**，**需要**或者**将要**：表示这个项目是标准中绝对需要的。
* **应该**或者**推荐的**：表示在特定情况下可能有一些合理的理由来忽略这个鹅项目，但在这之前应该全部理解并仔细权衡当前的案例。
* **或许**或者**可选的**： 表示这个项目确实是可选的，厂商可能基于一些市场需求选择这个项目，或者这个项目确实能说明产品经过了增强，另一个其他厂商可能会直接忽略这个项目。

如果**必须**项目中的一个或多个失败了，则设备对该协议的实现就是不符合规范的。如果在所有的**必须**和**应该**的项目都通过了，则设备对该协议的实现就是“无条件的符合规范”。如果通过了所有**必须**的项目，但是没有通过所有的**应该**的项目，则设备对该协议的视线就是“有条件的符合规范”。

## 6. 测试设定

理想状态下执行这一系列测试的方法是使用一台测试仪，测试仪包含发送和接收端口。测试仪产生连接，然后从发送端口发送流量到待测设备的接收端口，经过待测设备的转发，然后流量从待测设备的发送端口再发送到测试仪的接受端口中（见图1）。测试仪既发送流量也接受流量，这样就可以很容易的检查是否所有发送出去的包都被成功接收。同样的功能也可以使用发送和接受功能分离的测试仪（见图2）。但除非这两者都被某台计算机以某种方式控制着，不然这种应用所需要的人力（尤其是在吞吐量测试下）可能会令人望而却步。

```text
                            +------------+
                            |            |
               +------------|    测试仪   |<-------------+
               |            |            |              |
               |            +------------+              |
               |                                        |
               |            +------------+              |
               |            |            |              |
               +----------->|   待测设备  |--------------+
                            |            |
                            +------------+
                                 图 1
```
```text
         +--------+         +------------+          +----------+
         |        |         |            |          |          |
         | 发送方  |-------->|   待测设备   |--------->|  接收方   |
         |        |         |            |          |          |
         +--------+         +------------+          +----------+
                                 图 2
```

### 6.1 多种传输媒介的测试设定

在现网环境中，我们可以使用两种不同的测试设定来测试连接不同传输媒介的网络，比如本地以太网和骨干FDDI环网的链接。第一种拓扑是在上面图1的拓扑，这种情况下测试仪需要支持两种不同的媒介。

在第二种测试拓扑的设定中（见图3），我们需要两个相同的待测设备。在多数情况下这种设定可能更精确的模拟了像两个局域网通过一个广域网或者高速骨干网互联的情况。但这种拓扑不太适合模拟局域网内的某个客户端和FDDI骨干环网中某台服务器进行交互的情况。

```text
                               +-----------+
                               |           |
         +---------------------|  测试仪    |<---------------------+
         |                     |           |                      |
         |                     +-----------+                      |
         |                                                        |
         |        +----------+               +----------+         |
         |        |          |               |          |         |
         +------->| 待测设备1  |-------------->| 待测设备2 |---------+
                  |          |               |          |
                  +----------+               +----------+

                                    图 3
```

## 7. 待测设备配置

在开始进行测试之前，待测**设备**必须提前根据提供给用户的配置进行配置。特别要说明的是，我们期望的是所有支持的协议在整个测试期间都进行了配置（见附录A）。并且在所有测试的运行期间我们不会以任何形式去修改测试设备的配置和测试环境，除非某个特殊的用例需要。例如，在进行帧处理速度的测试时，我们不能够在测试期间去修改帧处理缓存的大小。或者，在测试某个协议的吞吐量时，我们也不能够在测试期间将除了这个协议之外的所有协议都关闭。在比如测试过滤规则对吞吐的影响这样的测试中，我们可能需要修改一些配置，但也**必须**仅限于使能特定的过滤规则。待测设备的配置**应该**包含一般的路由更新间隔和心跳报文频率。我们的测试报告中也**必须**包含待测设备所使用的特定软件版本，使用的具体配置还有可能关闭的某些功能。

## 8. 数据帧格式

测试流所使用的TCP/IP以太网报文格式可以在附录C：测试帧的格式章节找 到。其中描述的帧格式**应该**在本文中所描述的测试中使用，并配合特定的协议/传输媒介组合。并且这些数据帧也可以作为其他协议和传输媒介测试数据的模版使用。针对某个特定测试所使用的特定数据帧格式也**必须**包含进我们的测试报告。

## 9. 数据帧长度

所有本文档中描述的测试都**应该**在一个数据帧长度的集合中进行。特别要说明的是，所使用的数据帧长度应该包括协议在某种传输媒介中所允许的最大和最小长度的数据帧。并且在最大值和最小值中取足够的数据帧长度用例来测试当前设备的性能。除非有特殊标注，否则我们**应该**再每种测试中都至少使用五种数据帧长度来进行测试。

理论上，一个 UDP Echo 报文的最小帧长度应该包含一个IP头部（最小长度20），一个UDP头部（长度8）和传输媒介中需要使用的 MAC 级别的头部。理论上最大的帧长度取决于 IP 头部中的 length 字段。绝大多数情况下，实际的最大和最小帧长度都取决于传输媒介的限制。

理论上，用均匀分布帧处理速度的方式分布数据帧长度才是理想的。本文档的一些建议结合了这一种理论，但是定义了一些便于理解和记忆的帧大小。另外，我们对每种传输媒介类型都指定了很多相同大小的数据帧，以便于进行性能的比较。

请注意，在某些媒体类型上包含着不切实际的小帧（即，很少或根本没有用来存放数据的空间），这种类型的帧大小可以帮助我们获取测试设备的每帧处理开销。

### 9.1 以太网中使用的帧大小

```text
64， 128， 256， 512， 1024， 1280， 1518
```
这些帧的大小包含了以太网标准中所允许的最大和最小帧长度，同时包括了一些在最大和最小之间精心选择的帧长度来以更小的帧长度获得更大的帧处理速度。

### 9.2 4Mb 和 16Mb 的 Token 环网中所使用的帧大小

